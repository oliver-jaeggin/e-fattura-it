@if(count($invoice->items) > 0)
  <table class="table">
    <thead>
      <tr>
        <th>No.</th>
        <th>Descrizione prestazione</th>
        <th>Quantit√†</th>
        <th>Prezzo</th>
        <th>Aliquota IVA</th>
        <th>Importo</th>
        <th>Azzione</th>
      </tr>
    </thead>
    <tbody>
    <?php
    $i = 0;
    $all_items_total = 0;
    foreach($invoice->items as $invoiceItem):
      $i = $i +1;
      $all_items_total += $invoiceItem->total_item;
      $item_per_tax[$invoiceItem->tax] = 0;
      ?>
      <tr>
        <td><?php echo $i; ?></td>
        <td>{{ $invoiceItem->description ?? '' }}</td>
        <td>{{ $invoiceItem->qty ?? '' }} ore</td>
        <td><span class="prefix-currency">{{ $invoice->currency ?? '' }}</span> {{ $invoiceItem->price ?? '' }}</td>
        <td>{{ $invoiceItem->tax ?? '' }}%</td>
        <td><span class="prefix-currency">{{ $invoice->currency ?? '' }}</span> {{ $invoiceItem->total_item ?? '' }}</td>
        <td>
          <div class="flex flex--pos-x-around">
            <a href="/items/{{ $invoiceItem->id }}/edit" title="Modifica servizio/prodotto">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.5 10C17.279 10 17.067 10.0878 16.9108 10.2441C16.7545 10.4004 16.6667 10.6123 16.6667 10.8334V15.8334C16.6667 16.0544 16.5789 16.2663 16.4226 16.4226C16.2663 16.5789 16.0544 16.6667 15.8334 16.6667H4.16669C3.94567 16.6667 3.73371 16.5789 3.57743 16.4226C3.42115 16.2663 3.33335 16.0544 3.33335 15.8334V4.1667C3.33335 3.94568 3.42115 3.73372 3.57743 3.57744C3.73371 3.42116 3.94567 3.33336 4.16669 3.33336H9.16669C9.3877 3.33336 9.59966 3.24557 9.75594 3.08929C9.91222 2.93301 10 2.72104 10 2.50003C10 2.27902 9.91222 2.06706 9.75594 1.91077C9.59966 1.75449 9.3877 1.6667 9.16669 1.6667H4.16669C3.50365 1.6667 2.86776 1.93009 2.39892 2.39893C1.93008 2.86777 1.66669 3.50366 1.66669 4.1667V15.8334C1.66669 16.4964 1.93008 17.1323 2.39892 17.6011C2.86776 18.07 3.50365 18.3334 4.16669 18.3334H15.8334C16.4964 18.3334 17.1323 18.07 17.6011 17.6011C18.07 17.1323 18.3334 16.4964 18.3334 15.8334V10.8334C18.3334 10.6123 18.2456 10.4004 18.0893 10.2441C17.933 10.0878 17.721 10 17.5 10ZM5.00002 10.6334V14.1667C5.00002 14.3877 5.08782 14.5997 5.2441 14.756C5.40038 14.9122 5.61234 15 5.83335 15H9.36669C9.47636 15.0007 9.58508 14.9796 9.68661 14.9382C9.78814 14.8967 9.88049 14.8356 9.95835 14.7584L15.725 8.98336L18.0917 6.6667C18.1698 6.58923 18.2318 6.49706 18.2741 6.39551C18.3164 6.29396 18.3382 6.18504 18.3382 6.07503C18.3382 5.96502 18.3164 5.8561 18.2741 5.75455C18.2318 5.653 18.1698 5.56083 18.0917 5.48336L14.5584 1.90836C14.4809 1.83026 14.3887 1.76826 14.2872 1.72595C14.1856 1.68365 14.0767 1.66187 13.9667 1.66187C13.8567 1.66187 13.7478 1.68365 13.6462 1.72595C13.5447 1.76826 13.4525 1.83026 13.375 1.90836L11.025 4.2667L5.24169 10.0417C5.16445 10.1196 5.10335 10.2119 5.06188 10.3134C5.02041 10.415 4.99939 10.5237 5.00002 10.6334ZM13.9667 3.67503L16.325 6.03336L15.1417 7.2167L12.7834 4.85836L13.9667 3.67503ZM6.66669 10.975L11.6084 6.03336L13.9667 8.3917L9.02502 13.3334H6.66669V10.975Z" fill="currentColor"/>
              </svg>              
              <spann class="sr-only">Modifica servizio/prodotto</spann>
            </a>
            <button type="button" class="btn btn--icon-only" rel="{{ route('items.destroy', $invoiceItem->id) }}" value="{{ $invoiceItem->description }}" data-toggle="open" aria-expanded="false" aria-label="dialog" aria-controls="dialog-delete-item" title="Cancella servizio/prodotto">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M8.33333 15.0001C8.55435 15.0001 8.76631 14.9123 8.92259 14.756C9.07887 14.5997 9.16667 14.3878 9.16667 14.1667V9.16675C9.16667 8.94573 9.07887 8.73377 8.92259 8.57749C8.76631 8.42121 8.55435 8.33341 8.33333 8.33341C8.11232 8.33341 7.90036 8.42121 7.74408 8.57749C7.5878 8.73377 7.5 8.94573 7.5 9.16675V14.1667C7.5 14.3878 7.5878 14.5997 7.74408 14.756C7.90036 14.9123 8.11232 15.0001 8.33333 15.0001ZM16.6667 5.00008H13.3333V4.16675C13.3333 3.50371 13.0699 2.86782 12.6011 2.39898C12.1323 1.93014 11.4964 1.66675 10.8333 1.66675H9.16667C8.50363 1.66675 7.86774 1.93014 7.3989 2.39898C6.93006 2.86782 6.66667 3.50371 6.66667 4.16675V5.00008H3.33333C3.11232 5.00008 2.90036 5.08788 2.74408 5.24416C2.5878 5.40044 2.5 5.6124 2.5 5.83341C2.5 6.05443 2.5878 6.26639 2.74408 6.42267C2.90036 6.57895 3.11232 6.66675 3.33333 6.66675H4.16667V15.8334C4.16667 16.4965 4.43006 17.1323 4.8989 17.6012C5.36774 18.07 6.00363 18.3334 6.66667 18.3334H13.3333C13.9964 18.3334 14.6323 18.07 15.1011 17.6012C15.5699 17.1323 15.8333 16.4965 15.8333 15.8334V6.66675H16.6667C16.8877 6.66675 17.0996 6.57895 17.2559 6.42267C17.4122 6.26639 17.5 6.05443 17.5 5.83341C17.5 5.6124 17.4122 5.40044 17.2559 5.24416C17.0996 5.08788 16.8877 5.00008 16.6667 5.00008ZM8.33333 4.16675C8.33333 3.94573 8.42113 3.73377 8.57741 3.57749C8.73369 3.42121 8.94565 3.33341 9.16667 3.33341H10.8333C11.0543 3.33341 11.2663 3.42121 11.4226 3.57749C11.5789 3.73377 11.6667 3.94573 11.6667 4.16675V5.00008H8.33333V4.16675ZM14.1667 15.8334C14.1667 16.0544 14.0789 16.2664 13.9226 16.4227C13.7663 16.579 13.5543 16.6667 13.3333 16.6667H6.66667C6.44565 16.6667 6.23369 16.579 6.07741 16.4227C5.92113 16.2664 5.83333 16.0544 5.83333 15.8334V6.66675H14.1667V15.8334ZM11.6667 15.0001C11.8877 15.0001 12.0996 14.9123 12.2559 14.756C12.4122 14.5997 12.5 14.3878 12.5 14.1667V9.16675C12.5 8.94573 12.4122 8.73377 12.2559 8.57749C12.0996 8.42121 11.8877 8.33341 11.6667 8.33341C11.4457 8.33341 11.2337 8.42121 11.0774 8.57749C10.9211 8.73377 10.8333 8.94573 10.8333 9.16675V14.1667C10.8333 14.3878 10.9211 14.5997 11.0774 14.756C11.2337 14.9123 11.4457 15.0001 11.6667 15.0001Z" fill="currentColor"/>
              </svg>                
              <span class="sr-only">Cancella servizio/prodotto</span>
            </button>
          </div>
        </td>
        <input type="hidden" name="item-id-<?php echo $i; ?>" id="item-id-<?php echo $i; ?>" value="{{ $invoiceItem->id }}">
        <input type="hidden" name="item-total-<?php echo $i; ?>" id="item-total-<?php echo $i; ?>" class="input-item-total" value="{{ $invoiceItem->total }}">
      </tr>                        
    <?php endforeach; ?>

    <?php if(count($item_per_tax) >= 0): ?>
      <?php foreach($item_per_tax as $key => $val): ?>
        <?php
        $query_items_per_tax = DB::table('items')->where([
                            ['invoice_id', $invoice->id],
                            ['tax', $key],
                          ])->get();
        $sum = 0;
        foreach($query_items_per_tax as $val) {
          $sum += $val->total_item;
        }
        ?>
        <input type="hidden" name="item-tax-<?php echo $key; ?>-subtotal" id="item-tax-<?php echo $key; ?>-subtotal" data-tax-value="<?php echo $key; ?>" class="item-tax-subtotals" value="<?php echo $sum; ?>">
      <?php endforeach; ?>
    <?php endif; ?>
    <input type="hidden" name="all-items-total" id="all-items-total" value="<?php echo $all_items_total; ?>">
     
    </tbody>
  </table>
@else
  <div class="msg">
    <p>Nessun servizio/prodotto allegato.</p>
  </div>
@endif